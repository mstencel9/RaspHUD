#:import Animation kivy.animation.Animation
#:import MDProgressBar kivymd.progressbar.MDProgressBar
#:import MDSlider kivymd.slider.MDSlider
#:import MDList kivymd.list.MDList
#:import MDButton kivymd.button.MDRaisedButton

#:import math math

#V1.2.2

# Set Global Font Types to save typing later
#:set GaugeFont "data/fonts/Eurostile LT Std Medium.ttf"
#:set ButtonFont "data/fonts/Eurostile LT Std Extended 2.ttf"

# Dock Y ZERO coordinate base. This will make it easier to fine tune the dock pos when installed behind radio opening.
#:set Dock_y0 160

AnchorLayout:
    ScreenManager:
        id: sm
        Gauge4Screen:
            name: "gauge4"
            FloatLayout:
                Image:
                    source: "data/wallpapers/black.png"
                Label:
                    text:
                        str(math.floor(app.Speed)) if app.SpeedUnit == "MPH" \
                        else str(math.floor(app.Speed / 0.6213711922))
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 80
                    pos: -270, 170
                    font_name: GaugeFont
                Label:
                    text: str(app.RPM)
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 80
                    pos: -270, 60
                    font_name: GaugeFont
                Label:
                    text: app.SpeedUnit
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 15
                    pos: -230, 153
                    font_name: GaugeFont
                Label:
                    text: "RPM"
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 15
                    pos: -230, 43
                    font_name: GaugeFont
                Label:
                    text: app.currentgear
                    font_size: 200
                    size_hint: None, None
                    height: 150
                    width: 250
                    halign: 'center'
                    valign: 'middle'
                    font_hinting: None
                    pos: 550, 262
                    font_name: GaugeFont

        AnchorLayout: #define the QUICKEYS area
            FloatLayout:
                Image:
                    id: dock
                    source: 'data/elements/Dock/Dock.png'
                    opacity: 1
                    pos: 0, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 800
    
                Image:
                    id: BrightnessRibbon
                    source: 'data/elements/BrightnessRibbon/Ribbon.png'
                    opacity: 1
                    pos: 0, Dock_y0-250
                    size_hint: None, None
                    height: 300
                    width: 70
                Button:
                    id: BrightnessRibbon_full
                    background_normal: 'data/elements/BrightnessRibbon/Full.png'
                    background_down: 'data/elements/BrightnessRibbon/Full_pressed.png'
                    opacity: 1
                    pos: 0, Dock_y0 - 50
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.BrightnessSet(255)
                    on_press:
                        Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon)
                        Animation(y=Dock_y0 - 50, duration=.2).start(BrightnessRibbon_full)
                        Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_2third)
                        Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_1third)
                        Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_low)
                        Animation(y=Dock_y0 - 250, duration=0).start(BrightnessRibbon_exit)
                Button:
                    id: BrightnessRibbon_2third
                    background_normal: 'data/elements/BrightnessRibbon/2third.png'
                    background_down: 'data/elements/BrightnessRibbon/2third_pressed.png'
                    opacity: 1
                    pos: 0, Dock_y0 - 100
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.BrightnessSet(150)
                    on_press:
                        Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon)
                        Animation(y=Dock_y0 - 50, duration=.2).start(BrightnessRibbon_full)
                        Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_2third)
                        Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_1third)
                        Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_low)
                        Animation(y=Dock_y0 - 250, duration=0).start(BrightnessRibbon_exit)
                Button:
                    id: BrightnessRibbon_1third
                    background_normal: 'data/elements/BrightnessRibbon/1third.png'
                    background_down: 'data/elements/BrightnessRibbon/1third_pressed.png'
                    opacity: 1
                    pos: 0, Dock_y0 - 150
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.BrightnessSet(55)
                    on_press:
                        Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon)
                        Animation(y=Dock_y0 - 50, duration=.2).start(BrightnessRibbon_full)
                        Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_2third)
                        Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_1third)
                        Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_low)
                        Animation(y=Dock_y0 - 250, duration=0).start(BrightnessRibbon_exit)
                Button:
                    id: BrightnessRibbon_low
                    background_normal: 'data/elements/BrightnessRibbon/Low.png'
                    background_down: 'data/elements/BrightnessRibbon/Low_pressed.png'
                    opacity: 1
                    pos: 0, Dock_y0 - 200
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.BrightnessSet(15)
                    on_press:
                        Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon)
                        Animation(y=Dock_y0 - 50, duration=.2).start(BrightnessRibbon_full)
                        Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_2third)
                        Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_1third)
                        Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_low)
                        Animation(y=Dock_y0 - 250, duration=0).start(BrightnessRibbon_exit)
    
    
                Button:
                    id: dock_brightness
                    background_normal: 'data/elements/Dock/BrightnessButton.png'
                    background_down: 'data/elements/Dock/BrightnessButton_pressed.png'
                    opacity: 1
                    pos: 0, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.save()
                    on_press:
                        Animation(y=Dock_y0, duration=.2).start(BrightnessRibbon)
                        Animation(y=Dock_y0 + 200, duration=.2).start(BrightnessRibbon_full)
                        Animation(y=Dock_y0 + 150, duration=.2).start(BrightnessRibbon_2third)
                        Animation(y=Dock_y0 + 100, duration=.2).start(BrightnessRibbon_1third)
                        Animation(y=Dock_y0 + 50, duration=.2).start(BrightnessRibbon_low)
                        Animation(y=Dock_y0, duration=0).start(BrightnessRibbon_exit)
    
                Button:
                    id: BrightnessRibbon_exit
                    background_normal: 'data/elements/BrightnessRibbon/Exit.png'
                    background_down: 'data/elements/BrightnessRibbon/Exit_pressed.png'
                    opacity: 1
                    pos: 0, Dock_y0 - 250
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press:
                        Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon)
                        Animation(y=Dock_y0 - 50, duration=.2).start(BrightnessRibbon_full)
                        Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_2third)
                        Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_1third)
                        Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_low)
                        Animation(y=Dock_y0 - 250, duration=0).start(BrightnessRibbon_exit)
    
                Button:
                    id: dock_settings
                    background_normal: 'data/elements/Dock/SettingsButton.png'
                    background_down: 'data/elements/Dock/SettingsButton_pressed.png'
                    opacity: 1
                    pos: 670, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.save()
                    on_press: sm.current = 'settings'
    
                Button:
                    id: dock_power
                    background_normal: 'data/elements/Dock/PowerButton.png'
                    background_down: 'data/elements/Dock/PowerButton_pressed.png'
                    opacity: 1
                    pos: 730, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.save()
                    on_press: app.ScreenOnOff("OFF")
                    on_release: app.shutdown()
    
                Button:
                    id: dock_gauge1
                    background_normal: 'data/elements/Dock/DockPill.png'
                    background_down: 'data/elements/Dock/DockPill_pressed.png'
                    opacity: 1
                    pos: 66, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 101
                    on_press:
                        sm.transition.direction = 'left'
                        sm.current = 'gauge1'
                        app.OBDOFF()
                        app.OBDEnabler("CoolantTemp",1)
                        app.OBDEnabler("IntakeTemp",1)
                        app.OBDEnabler("Voltage",1)
                        app.save()
                    Label:
                        text: "1"
                        text_size: 101, 70
                        valign: 'middle'
                        halign: 'center'
                        font_size: 28
                        font_name: ButtonFont
                        pos: self.parent.center_x - 50, self.parent.center_y - 53
    
    
    
                Button:
                    id: dock_gauge2
                    background_normal: 'data/elements/Dock/DockPill.png'
                    background_down: 'data/elements/Dock/DockPill_pressed.png'
                    opacity: 1
                    pos: 168, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 101
                    on_press:
                        sm.transition.direction = 'left'
                        sm.current = 'gauge2'
                        app.OBDOFF()
                        app.OBDEnabler("CoolantTemp",1)
                        app.OBDEnabler("STFT",1)
                        app.OBDEnabler("LTFT",1)
                        app.save()
                    Label:
                        text: "2"
                        text_size: 101, 70
                        valign: 'middle'
                        halign: 'center'
                        font_size: 28
                        font_name: ButtonFont
                        pos: self.parent.center_x - 50, self.parent.center_y - 53
    
                Button:
                    id: dock_gauge3
                    background_normal: 'data/elements/Dock/DockPill.png'
                    background_down: 'data/elements/Dock/DockPill_pressed.png'
                    opacity: 1
                    pos: 270, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 101
                    on_press:
                        sm.transition.direction = 'left'
                        sm.current = 'gauge3'
                        app.OBDOFF()
                        app.OBDEnabler("ThrottlePos",1)
                        app.OBDEnabler("Load",1)
                        app.OBDEnabler("TimingAdv",1)
                        app.save()
                    Label:
                        text: "3"
                        text_size: 101, 70
                        valign: 'middle'
                        halign: 'center'
                        font_size: 28
                        font_name: ButtonFont
                        pos: self.parent.center_x - 50, self.parent.center_y - 53
    
                Button:
                    id: dock_gauge4
                    background_normal: 'data/elements/Dock/DockPill.png'
                    background_down: 'data/elements/Dock/DockPill_pressed.png'
                    opacity: 1
                    pos: 371, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 101
                    on_press:
                        sm.transition.direction = 'left'
                        sm.current = 'gauge4'
                        app.OBDOFF()
                        app.OBDEnabler("Speed",1)
                        app.OBDEnabler("RPM",1)
                        app.OBDEnabler("Gear",1)
                        app.save()
                    Label:
                        text: "4"
                        text_size: 101, 70
                        valign: 'middle'
                        halign: 'center'
                        font_size: 28
                        font_name: ButtonFont
                        pos: self.parent.center_x - 50, self.parent.center_y - 53
    
                Button:
                    id: dock_max
                    background_normal: 'data/elements/Dock/DockPill.png'
                    background_down: 'data/elements/Dock/DockPill_pressed.png'
                    opacity: 1
                    pos: 472, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 101
                    on_press:
                        sm.transition.direction = 'left'
                        sm.current = 'max'
                        app.OBDOFF()
                        app.OBDEnabler("Speed",1)
                        app.OBDEnabler("RPM",1)
                        app.save()
                    Label:
                        text: "MAX"
                        text_size: 101, 70
                        valign: 'middle'
                        halign: 'center'
                        font_size: 20
                        font_name: ButtonFont
                        pos: self.parent.center_x - 50, self.parent.center_y - 53
    
                Button:
                    id: dock_CEL
                    background_normal: 'data/elements/Dock/DockPill_CEL.png'
                    background_down: 'data/elements/Dock/DockPill_CEL_pressed.png'
                    opacity: 1
                    pos: 573, Dock_y0
                    size_hint: None, None
                    height: 70
                    width: 101
                    on_press:
                        sm.transition.direction = 'left'
                        sm.current = 'DTC'
                        app.OBDOFF()
                        app.save()
    
                FloatLayout:  # Black "cover" for hidden part of screen
                    canvas:
                        Rectangle:
                            source: 'data/elements/Dock/UnviewableArea.png'
                            pos: 0, 0
                            size: 800, Dock_y0

